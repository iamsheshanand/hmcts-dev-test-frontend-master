{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/select/macro.njk" import govukSelect %}

{% extends "template.njk" %}

{% block content %}
<a href="/" class="govuk-back-link">Back to Task List</a>
  <h1 class="govuk-heading-m">{% if task %}Edit Task{% else %}Create Task{% endif %}</h1>
  {% if error %}
    <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1">
      <h2 class="govuk-error-summary__title" id="error-summary-title">There is a problem</h2>
      <div class="govuk-error-summary__body">
        <ul class="govuk-list govuk-error-summary__list">
          <li>{{ error }}</li>
        </ul>
      </div>
    </div>
  {% endif %}
  <form method="POST" action="{% if task %}/tasks/{{ task.id }}?_method=PATCH{% else %}/tasks{% endif %}">
   {% set isDisabled = task is not none %}
    {{ govukInput({
      label: { text: "Title" },
      id: "title",
      name: "title",
      value: task.title,
      classes: "govuk-input--width-10",
      disabled: isDisabled,
      attributes: {
    required: true,
    maxlength: 100
  },
  errorMessage: error and error.field == "title" and { text: error.message }
    }) }}
    {{ govukInput({
          label: { text: "Description" },
          id: "description",
          name: "description",
          value: task.description,
          classes: "govuk-input--width-10",
          disabled: isDisabled
        }) }}
        {% if not task %}
            {{ govukDateInput({
              id: "due-date",
              namePrefix: "dueDate",
              fieldset: {
                legend: {
                  text: "Due Date",
                  classes: "govuk-fieldset__legend--m"
                }
              },
              hint: {
                text: "For example, 27 3 2007"
              },
              value: task.dueDate,
              disabled: isDisabled,
              attributes: {
    required: true,
    maxlength: 100
  },
  errorMessage: error and error.field == "due-date" and { text: error.message }
            }) }}
            {% endif %}
        {{ govukSelect({
          id: "status",
          name: "status",
          label: {
            text: "Status"
          },
          items: [
            {
              value: "TODO",
              text: "To Do",
              selected: task and task.status == "TODO"
            },
            {
              value: "COMPLETED",
              text: "Completed",
              selected: task and task.status == "COMPLETED"
            },
            {
              value: "IN_PROGRESS",
              text: "In Progress",
              selected: task and task.status == "IN_PROGRESS"
            }
          ]
        }) }}
    {{ govukButton({ text: "Save" }) }}
  </form>
{% endblock %}
